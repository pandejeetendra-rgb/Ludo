<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Social Media Security ‚Äî Cyber Ludo Quiz (Model B)</title>
<style>
  :root{
    --bg1:#0b1020;
    --bg2:#0b2a55;
    --card: rgba(255,255,255,.08);
    --card2: rgba(255,255,255,.12);
    --stroke: rgba(255,255,255,.18);
    --text:#f7fbff;
    --muted: rgba(247,251,255,.75);

    --p1:#34d399;   /* learner */
    --p2:#fb7185;   /* computer */
    --accent:#60a5fa;

    --cell1:#101a3a;
    --cell2:#12224b;
    --safe:#fbbf24;

    --ok:#22c55e;
    --bad:#ef4444;

    --shadow: 0 12px 35px rgba(0,0,0,.35);
    --radius: 18px;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    min-height:100vh;
    background:
      radial-gradient(1200px 700px at 15% 10%, rgba(96,165,250,.35), transparent 60%),
      radial-gradient(900px 700px at 85% 20%, rgba(52,211,153,.25), transparent 55%),
      radial-gradient(900px 700px at 80% 90%, rgba(251,113,133,.22), transparent 60%),
      linear-gradient(160deg, var(--bg1), var(--bg2));
  }

  .wrap{
    max-width: 1200px;
    margin: 0 auto;
    padding: 18px;
    display:grid;
    grid-template-columns: 1.1fr .9fr;
    gap: 16px;
  }

  @media (max-width: 980px){
    .wrap{grid-template-columns:1fr; padding:14px;}
  }

  .topbar{
    grid-column: 1 / -1;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding: 12px 14px;
    border:1px solid var(--stroke);
    border-radius: var(--radius);
    background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
    box-shadow: var(--shadow);
  }

  .brand{ display:flex; align-items:center; gap:10px; }
  .logo{
    width:38px; height:38px; border-radius:12px;
    background:
      radial-gradient(circle at 30% 35%, rgba(255,255,255,.55), transparent 45%),
      linear-gradient(135deg, rgba(96,165,250,.9), rgba(52,211,153,.9));
    box-shadow: 0 10px 20px rgba(0,0,0,.25);
  }
  .brand h1{ font-size: 16px; margin:0; line-height:1.2; letter-spacing:.2px; }
  .brand p{ margin:2px 0 0; font-size: 12px; color: var(--muted); }

  .actions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end; }

  button{
    border: 1px solid var(--stroke);
    background: rgba(255,255,255,.10);
    color: var(--text);
    padding: 10px 12px;
    border-radius: 14px;
    cursor:pointer;
    transition: transform .08s ease, background .15s ease, border-color .15s ease;
    font-weight: 650;
    letter-spacing:.15px;
  }
  button:hover{ background: rgba(255,255,255,.14); }
  button:active{ transform: scale(.98); }
  button.primary{
    border-color: rgba(96,165,250,.55);
    background: linear-gradient(180deg, rgba(96,165,250,.30), rgba(96,165,250,.18));
  }
  button.good{
    border-color: rgba(34,197,94,.55);
    background: linear-gradient(180deg, rgba(34,197,94,.25), rgba(34,197,94,.12));
  }
  button.danger{
    border-color: rgba(239,68,68,.55);
    background: linear-gradient(180deg, rgba(239,68,68,.22), rgba(239,68,68,.10));
  }
  button:disabled{ opacity:.55; cursor:not-allowed; }

  .card{
    border:1px solid var(--stroke);
    border-radius: var(--radius);
    background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
    box-shadow: var(--shadow);
    overflow:hidden;
  }
  .card .hd{
    padding: 12px 14px;
    border-bottom: 1px solid rgba(255,255,255,.10);
    display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .card .hd .ttl{ font-weight: 800; letter-spacing:.2px; }
  .card .hd .sub{ font-size:12px; color:var(--muted); }
  .card .bd{ padding: 14px; }

  .boardWrap{ display:flex; gap:14px; align-items:flex-start; flex-wrap:wrap; }

  .board{
    width: min(520px, 100%);
    aspect-ratio: 1 / 1;
    border-radius: 22px;
    border: 1px solid rgba(255,255,255,.20);
    background:
      radial-gradient(circle at 35% 35%, rgba(255,255,255,.08), transparent 55%),
      radial-gradient(circle at 70% 75%, rgba(255,255,255,.06), transparent 55%),
      linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
    box-shadow: 0 18px 40px rgba(0,0,0,.35);
    padding: 14px;
    position: relative;
  }

  .track{
    width:100%;
    height:100%;
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    grid-template-rows: repeat(7, 1fr);
    gap: 8px;
  }

  .cell{
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.10);
    background: linear-gradient(180deg, rgba(16,26,58,.9), rgba(18,34,75,.9));
    position: relative;
    overflow:hidden;
  }
  .cell::after{
    content:"";
    position:absolute; inset:-1px;
    background:
      radial-gradient(circle at 30% 30%, rgba(255,255,255,.10), transparent 50%),
      radial-gradient(circle at 70% 80%, rgba(255,255,255,.06), transparent 55%);
    pointer-events:none;
  }

  .cell.safe{
    border-color: rgba(251,191,36,.55);
    background:
      radial-gradient(circle at 30% 30%, rgba(251,191,36,.20), transparent 60%),
      linear-gradient(180deg, rgba(251,191,36,.15), rgba(16,26,58,.85));
  }

  .cell.start{
    border-color: rgba(96,165,250,.55);
    background:
      radial-gradient(circle at 35% 30%, rgba(96,165,250,.22), transparent 60%),
      linear-gradient(180deg, rgba(96,165,250,.18), rgba(16,26,58,.85));
  }

  .cell.finish{
    border-color: rgba(34,197,94,.60);
    background:
      radial-gradient(circle at 35% 30%, rgba(34,197,94,.22), transparent 60%),
      linear-gradient(180deg, rgba(34,197,94,.16), rgba(16,26,58,.85));
  }

  .badge{
    position:absolute; top:8px; left:8px;
    font-size: 11px;
    color: rgba(247,251,255,.80);
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    backdrop-filter: blur(6px);
    z-index: 2;
  }

  .tokens{
    position:absolute; right:8px; bottom:8px;
    display:flex; gap:6px;
    z-index: 3;
  }

  .token{
    width: 20px; height: 20px;
    border-radius: 8px;
    border: 2px solid rgba(255,255,255,.85);
    box-shadow: 0 10px 20px rgba(0,0,0,.30);
    position: relative;
  }
  .token::after{
    content:"";
    position:absolute; inset:3px;
    border-radius: 6px;
    background: rgba(255,255,255,.18);
    mix-blend-mode: screen;
  }
  .t1{ background: linear-gradient(135deg, rgba(52,211,153,.95), rgba(16,185,129,.85)); }
  .t2{ background: linear-gradient(135deg, rgba(251,113,133,.95), rgba(244,63,94,.85)); }

  .legend{ flex: 1 1 250px; display:grid; gap: 12px; min-width: 240px; }
  .statRow{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }

  .pill{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.07);
    border-radius: 16px;
    padding: 10px 12px;
  }
  .pill .k{ font-size:12px; color: var(--muted); }
  .pill .v{ font-size: 16px; font-weight: 850; margin-top: 2px; }

  .progressBar{
    height: 12px;
    border-radius: 999px;
    background: rgba(255,255,255,.10);
    border: 1px solid rgba(255,255,255,.14);
    overflow:hidden;
  }
  .bar{ height:100%; width:0%; background: linear-gradient(90deg, rgba(96,165,250,.9), rgba(52,211,153,.9)); }

  .qText{
    font-size: 16px;
    font-weight: 800;
    line-height: 1.35;
    margin: 0 0 12px;
  }
  .optGrid{ display:grid; grid-template-columns: 1fr; gap: 10px; }
  .optBtn{
    text-align:left;
    font-weight: 750;
    padding: 12px 12px;
    border-radius: 16px;
    background: rgba(255,255,255,.08);
  }
  .optBtn .lab{
    display:inline-flex;
    width: 30px; height: 30px;
    align-items:center; justify-content:center;
    border-radius: 12px;
    margin-right: 10px;
    font-weight: 900;
    border: 1px solid rgba(255,255,255,.18);
    background: rgba(0,0,0,.18);
  }
  .optBtn:hover{ background: rgba(255,255,255,.12); }

  .note{ font-size: 12px; color: var(--muted); line-height: 1.5; }

  .diceBox{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid rgba(255,255,255,.10);
  }
  .dice{
    width: 54px;
    height: 54px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.18);
    background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.22), rgba(255,255,255,.07));
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: 22px;
    font-weight: 950;
    box-shadow: 0 12px 24px rgba(0,0,0,.28);
    user-select:none;
  }

  .overlay{
    position: fixed; inset: 0;
    background: rgba(0,0,0,.55);
    display:none;
    align-items:center;
    justify-content:center;
    padding: 18px;
    z-index: 999;
  }
  .modal{
    width: min(620px, 100%);
    border-radius: 22px;
    border: 1px solid rgba(255,255,255,.18);
    background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
    box-shadow: 0 18px 50px rgba(0,0,0,.45);
    overflow:hidden;
  }
  .modal .mhd{
    padding: 14px 16px;
    border-bottom: 1px solid rgba(255,255,255,.10);
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .modal .mhd .mt{ font-weight: 950; }
  .modal .mbd{ padding: 16px; color: rgba(247,251,255,.92); }

  .kbd{ display:grid; gap: 10px; margin-top: 10px; }
  .kbd div{
    padding: 10px 12px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    color: rgba(247,251,255,.92);
    font-size: 13px;
    line-height: 1.45;
  }

  .bigPop{
    position: fixed;
    left: 50%;
    top: 14%;
    transform: translateX(-50%);
    padding: 12px 18px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.22);
    background: rgba(0,0,0,.30);
    backdrop-filter: blur(8px);
    font-weight: 950;
    letter-spacing:.3px;
    display:none;
    z-index: 998;
    box-shadow: 0 18px 45px rgba(0,0,0,.35);
  }
  .bigPop.ok{ color: rgba(34,197,94,.95); }
  .bigPop.bad{ color: rgba(239,68,68,.95); }

  .shake{ animation: shake .25s linear 1; }
  @keyframes shake{
    0%{ transform: translate(0,0); }
    20%{ transform: translate(-5px, 2px); }
    40%{ transform: translate(4px, -3px); }
    60%{ transform: translate(-3px, 1px); }
    80%{ transform: translate(3px, 2px); }
    100%{ transform: translate(0,0); }
  }

  .cornerTag{
    position:absolute;
    left: 14px;
    bottom: 14px;
    padding: 8px 10px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.18);
    color: rgba(247,251,255,.88);
    font-size: 12px;
    max-width: 68%;
  }
</style>
</head>
<body>
  <div class="wrap" id="app">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Social Media Security ‚Äî Cyber Ludo Quiz (Model B)</h1>
          <p>Learner moves on correct answers ‚Ä¢ Computer moves only when learner is wrong</p>
        </div>
      </div>
      <div class="actions">
        <button class="primary" id="btnHow">How to Play</button>
        <button id="btnRestart" class="danger">Restart</button>
      </div>
    </div>

    <div class="card">
      <div class="hd">
        <div>
          <div class="ttl">Game Board</div>
          <div class="sub">Race to ‚ÄúHome‚Äù using safe social media practices.</div>
        </div>
        <div style="text-align:right">
          <div class="sub">Computer step on wrong:</div>
          <div class="ttl" id="compStepLabel">+2</div>
        </div>
      </div>
      <div class="bd">
        <div class="boardWrap">
          <div class="board" id="board">
            <div class="track" id="track"></div>
            <div class="cornerTag">
              Tip: Correct ‚Üí you move. Wrong ‚Üí computer moves +2. No luck-based opponent.
            </div>
          </div>

          <div class="legend">
            <div class="statRow">
              <div class="pill">
                <div class="k">Learner Position</div>
                <div class="v"><span style="color:var(--p1)">‚óè</span> <span id="p1Pos">0</span> / <span id="maxPos">0</span></div>
              </div>
              <div class="pill">
                <div class="k">Computer Position</div>
                <div class="v"><span style="color:var(--p2)">‚óè</span> <span id="p2Pos">0</span> / <span id="maxPos2">0</span></div>
              </div>
            </div>

            <div class="pill">
              <div class="k">Progress</div>
              <div class="progressBar" aria-label="progress"><div class="bar" id="bar"></div></div>
              <div class="note" style="margin-top:8px">
                Questions answered: <b id="qDone">0</b> / <b id="qTotal">0</b> ‚Ä¢ Correct: <b id="qCorrect">0</b>
              </div>
            </div>

            <div class="pill">
              <div class="k">Dice (roll happens only after correct answer)</div>
              <div class="diceBox">
                <div class="dice" id="dice">‚Äî</div>
                <div class="note" style="flex:1">
                  Correct ‚Üí roll & move.<br/>
                  Wrong ‚Üí computer moves +2.
                </div>
              </div>
            </div>

            <div class="pill">
              <div class="k">Status</div>
              <div class="v" id="statusText" style="font-size:15px; font-weight:850;">
                Answer the question to start.
              </div>
              <div class="note" id="statusSub" style="margin-top:6px;">
                Keep accuracy high to stay ahead.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="hd">
        <div>
          <div class="ttl">Quiz Turn</div>
          <div class="sub">One question per turn. No retries for the same question.</div>
        </div>
        <button class="good" id="btnSkip" title="Optional: move to next question without movement">Skip (No Move)</button>
      </div>
      <div class="bd">
        <p class="qText" id="qText">Loading‚Ä¶</p>
        <div class="optGrid" id="opts"></div>

        <div class="note" style="margin-top: 12px;">
          Model B: The computer token never answers questions. It moves only when you answer incorrectly.
        </div>
      </div>
    </div>
  </div>

  <div class="bigPop" id="bigPop"></div>

  <div class="overlay" id="overlay" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="mhd">
        <div class="mt" id="modalTitle">How to Play</div>
        <button id="btnClose">Close</button>
      </div>
      <div class="mbd" id="modalBody"></div>
    </div>
  </div>

<script>
(() => {
  // ============================
  // CONFIG
  // ============================
  const COMPUTER_STEP_ON_WRONG = 2; // Model B constraint (keep <= 2)
  const SAFE_INDICES = new Set([3, 7, 11, 15, 19]); // only visual

  const TRACK_GRID_INDEX = [
    2,3,4,5,6,
    13,20,27,34,41,
    46,45,44,43,42,
    35,28,21,14,7,
    8,9,10,11
  ];
  const TRACK_LEN = TRACK_GRID_INDEX.length;
  const FINISH_INDEX = TRACK_LEN - 1;

  // ============================
  // QUESTIONS (Derived from uploaded PDFs)
  // Balanced correct options across A/B/C/D
  // ============================
  const QUESTIONS = [
    // A (index 0)
    { q:"Why is it recommended to use https:// when accessing social networking sites?",
      opts:["It encrypts traffic between your browser and the site","It blocks all ads automatically","It makes your posts invisible to the site owner","It prevents account creation"],
      a:0,
      fb:"Using https:// adds encryption to protect usernames, passwords, and posted data in transit."
    },
    // B (index 1)
    { q:"On Facebook, what is strongly recommended on the 'Find Your Friends' screen during account setup?",
      opts:["Enter email password so Facebook can import contacts","Skip providing your email password to Facebook","Upload a profile photo immediately","Join multiple networks to be discoverable"],
      a:1,
      fb:"It is strongly recommended to skip giving your email password for contact importing."
    },
    // C (index 2)
    { q:"Which Facebook security option helps alert you when someone logs in from an unfamiliar device?",
      opts:["Blocked Users","Restricted List","Login Notifications","Public Search"],
      a:2,
      fb:"Login Notifications can alert you about logins from devices you have not used before."
    },
    // D (index 3)
    { q:"In Facebook advertising settings, what setting is recommended for 'Third Party Sites' to reduce exposure?",
      opts:["Everyone","Friends","Only me","No-one"],
      a:3,
      fb:"Setting Third Party Sites to 'No-one' helps reduce sharing/association for third-party ads."
    },

    // A
    { q:"If you want only your contacts to see your Facebook status updates, the recommended setting is:",
      opts:["Friends Only (or a chosen restricted audience)","Public by default","Friends of friends only","Allow search engines to link to your timeline"],
      a:0,
      fb:"Use a restricted audience like 'Friends Only' (and remember content can still be copied)."
    },
    // B
    { q:"On Twitter, which option is suggested if you want tweets visible only to approved followers?",
      opts:["Enable location","Allow photo tagging","Protect Your Tweets","Enable public discovery"],
      a:2,
      fb:"Protecting tweets limits visibility to approved followers (though the platform can still access data)."
    , a:2}, // keep correct index 2; we will fix below to keep balance.
  ];

  // The above accidental duplicate 'a' would break. We'll rebuild QUESTIONS cleanly below.

})();
</script>

<script>
/* ============================
   FIXED: Build QUESTIONS cleanly (no duplicate keys)
============================ */
(() => {
  const QUESTIONS = [
    // 1 (A)
    { q:"Why is it recommended to use https:// when accessing social networking sites?",
      opts:["It encrypts traffic between your browser and the site","It blocks all ads automatically","It makes your posts invisible to the site owner","It prevents account creation"],
      a:0,
      fb:"Using https:// adds encryption to protect usernames, passwords, and posted data in transit."
    },
    // 2 (B)
    { q:"During Facebook account setup, what is strongly recommended on the 'Find Your Friends' step?",
      opts:["Enter your email password so Facebook can import contacts","Skip providing your email password to Facebook","Upload a profile photo immediately","Join many networks to become discoverable"],
      a:1,
      fb:"It is strongly recommended to skip giving your email password for contact importing."
    },
    // 3 (C)
    { q:"Which Facebook security feature can alert you when someone logs in from a device you have not used before?",
      opts:["Restricted List","Code Generator","Login Notifications","Public Search"],
      a:2,
      fb:"Login Notifications can alert you about logins from unfamiliar devices."
    },
    // 4 (D)
    { q:"In Facebook advertising settings, what is recommended for 'Third Party Sites' to reduce future exposure?",
      opts:["Everyone","Friends","Only Me","No-one"],
      a:3,
      fb:"Setting Third Party Sites to 'No-one' helps reduce third-party advertising association."
    },

    // 5 (A)
    { q:"If you want only your contacts to see your Facebook status updates, the recommended default is:",
      opts:["Friends Only (or a restricted audience you choose)","Public (everyone)","Friends of friends","Anyone via search engines"],
      a:0,
      fb:"Use a restricted audience like 'Friends Only'. Remember content can still be copied or reshared."
    },
    // 6 (B)
    { q:"What is the recommended choice for Twitter photo tagging to reduce risk?",
      opts:["Allow everyone to tag you","Do not allow anyone to tag you in photos","Allow only followers to tag you","Enable tagging suggestions"],
      a:1,
      fb:"Since approvals may not exist for photo tags, the safer option is to disallow photo tagging."
    },
    // 7 (C)
    { q:"Which Twitter setting limits who can see your tweets to approved followers only?",
      opts:["Tweet location","Discoverability","Protect my tweets","Personalisation and promotion"],
      a:2,
      fb:"Protecting tweets limits visibility to approved followers (though the platform can still access data)."
    },
    // 8 (D)
    { q:"A key risk of integrating multiple social networking accounts (e.g., Twitter auto-posting to Facebook) is:",
      opts:["It always increases privacy","It forces HTTPS on all sites","It hides your identity everywhere","You may be anonymous on one site but exposed on another"],
      a:3,
      fb:"Cross-posting can reveal identity across platforms even if you try to stay anonymous on one."
    },

    // 9 (A)
    { q:"Why should you be careful about posting photos/videos online, even when privacy settings are used?",
      opts:["They can reveal identities and sensitive metadata (date/time/location)","They automatically delete after 24 hours","They cannot be copied by others","They are invisible to platform owners"],
      a:0,
      fb:"Photos/videos can expose identities and hidden metadata like time and location."
    },
    // 10 (B)
    { q:"Which is a recommended safe practice before posting a photo or video of another person?",
      opts:["Tag them publicly","Get their consent first","Share it only in comments","Post it first and ask later"],
      a:1,
      fb:"Always get consent before posting photos/videos of others; consider possible repercussions."
    },
    // 11 (C)
    { q:"What is a recommended precaution about location sharing on social media?",
      opts:["Always enable GPS tagging","Share live location in every update","Double-check location settings and keep them disabled unless needed","Location can never be inferred without GPS"],
      a:2,
      fb:"Be mindful of location settings; double-check and keep disabled unless truly needed."
    },
    // 12 (D)
    { q:"The guide compares social networking sites to a 'huge party' mainly to highlight that:",
      opts:["You can trust everyone equally","Only friends can see your content","Privacy settings fully protect you from service owners","You may reveal personal details widely without realizing it"],
      a:3,
      fb:"It warns that you might expose personal details to many people without full awareness."
    },

    // 13 (A)
    { q:"Which email practice is recommended to reduce malware risk?",
      opts:["Do not open unexpected attachments, especially from unknown senders","Open all attachments to check content quickly","Disable antivirus warnings","Forward suspicious attachments to friends"],
      a:0,
      fb:"Unexpected attachments are a common malware route; be cautious and keep antivirus updated."
    },
    // 14 (B)
    { q:"If you want to avoid revealing identity when creating an email account, the guide suggests using:",
      opts:["Your full legal name as username","Anonymity software such as Tor","The same username everywhere","Only a public/work email address"],
      a:1,
      fb:"Tor can help hide your connection; avoid usernames tied to personal/professional identity."
    },
    // 15 (C)
    { q:"A common sign of an email scam is:",
      opts:["A normal update from a known contact","A calendar invite you requested","A message claiming urgent action to 'update account info' or your account will be shut down","A plain-text email with no links"],
      a:2,
      fb:"Scam emails often create urgency and ask you to click links or submit account details."
    },
    // 16 (D)
    { q:"If your browser suddenly warns about an invalid security certificate when accessing webmail, it may indicate:",
      opts:["Your inbox is full","Your password is too strong","The email provider is permanently offline","Possible tampering/interception of the connection"],
      a:3,
      fb:"Invalid certificate warnings can indicate interception or man-in-the-middle tampering."
    }
  ];

  // ============================
  // STATE
  // ============================
  const COMPUTER_STEP_ON_WRONG = 2;
  const SAFE_INDICES = new Set([3, 7, 11, 15, 19]);
  const TRACK_GRID_INDEX = [
    2,3,4,5,6,
    13,20,27,34,41,
    46,45,44,43,42,
    35,28,21,14,7,
    8,9,10,11
  ];
  const TRACK_LEN = TRACK_GRID_INDEX.length;
  const FINISH_INDEX = TRACK_LEN - 1;

  let idxOrder = [];
  let qIndex = 0;
  let answered = 0;
  let correct = 0;

  let p1 = 0;
  let p2 = 0;
  let locked = false;
  let gameOver = false;

  // ============================
  // DOM
  // ============================
  const app = document.getElementById("app");
  const trackEl = document.getElementById("track");
  const p1PosEl = document.getElementById("p1Pos");
  const p2PosEl = document.getElementById("p2Pos");
  const maxPosEl = document.getElementById("maxPos");
  const maxPos2El = document.getElementById("maxPos2");
  const barEl = document.getElementById("bar");
  const qDoneEl = document.getElementById("qDone");
  const qTotalEl = document.getElementById("qTotal");
  const qCorrectEl = document.getElementById("qCorrect");
  const statusTextEl = document.getElementById("statusText");
  const statusSubEl = document.getElementById("statusSub");
  const diceEl = document.getElementById("dice");
  const compStepLabelEl = document.getElementById("compStepLabel");

  const qTextEl = document.getElementById("qText");
  const optsEl = document.getElementById("opts");

  const overlay = document.getElementById("overlay");
  const modalTitle = document.getElementById("modalTitle");
  const modalBody = document.getElementById("modalBody");
  const bigPop = document.getElementById("bigPop");

  // Buttons
  document.getElementById("btnHow").addEventListener("click", () => showHow());
  document.getElementById("btnClose").addEventListener("click", () => hideModal());
  overlay.addEventListener("click", (e) => { if (e.target === overlay) hideModal(); });
  document.getElementById("btnRestart").addEventListener("click", () => restart());
  document.getElementById("btnSkip").addEventListener("click", () => {
    if (locked || gameOver) return;
    popNeutral("Skipped (no movement)");
    advanceQuestion();
  });

  // init labels
  compStepLabelEl.textContent = `+${COMPUTER_STEP_ON_WRONG}`;
  maxPosEl.textContent = FINISH_INDEX;
  maxPos2El.textContent = FINISH_INDEX;
  qTotalEl.textContent = QUESTIONS.length;

  buildBoard();
  restart();

  // ============================
  // BOARD
  // ============================
  function buildBoard(){
    trackEl.innerHTML = "";
    for(let i=0;i<49;i++){
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.dataset.grid = String(i);

      const tpos = TRACK_GRID_INDEX.indexOf(i);
      if (tpos !== -1){
        cell.dataset.track = String(tpos);

        if (tpos === 0) cell.classList.add("start");
        if (tpos === FINISH_INDEX) cell.classList.add("finish");
        if (SAFE_INDICES.has(tpos)) cell.classList.add("safe");

        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = (tpos === 0) ? "START" : (tpos === FINISH_INDEX) ? "HOME" : `#${tpos}`;
        cell.appendChild(badge);

        const tokens = document.createElement("div");
        tokens.className = "tokens";
        tokens.innerHTML = `
          <div class="token t1" style="display:none" aria-label="Learner token"></div>
          <div class="token t2" style="display:none" aria-label="Computer token"></div>
        `;
        cell.appendChild(tokens);
      }
      trackEl.appendChild(cell);
    }
  }

  // ============================
  // GAME
  // ============================
  function restart(){
    idxOrder = Array.from({length: QUESTIONS.length}, (_,i)=>i);
    shuffle(idxOrder);

    qIndex = 0;
    answered = 0;
    correct = 0;

    p1 = 0;
    p2 = 0;
    locked = false;
    gameOver = false;

    diceEl.textContent = "‚Äî";
    updateStats();
    renderTokens();
    setStatus("Answer the question to start.", "Correct ‚Üí you roll & move. Wrong ‚Üí computer moves +2.");
    renderQuestion();
  }

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  function renderTokens(){
    document.querySelectorAll(".cell[data-track] .token").forEach(t => t.style.display="none");
    const p1Cell = getTrackCell(p1);
    const p2Cell = getTrackCell(p2);
    if (p1Cell) p1Cell.querySelector(".t1").style.display = "inline-block";
    if (p2Cell) p2Cell.querySelector(".t2").style.display = "inline-block";
  }

  function getTrackCell(trackPos){
    const gridIndex = TRACK_GRID_INDEX[trackPos];
    return document.querySelector(`.cell[data-grid="${gridIndex}"]`);
  }

  function updateStats(){
    p1PosEl.textContent = p1;
    p2PosEl.textContent = p2;

    qDoneEl.textContent = answered;
    qCorrectEl.textContent = correct;

    const pct = QUESTIONS.length ? Math.round((answered / QUESTIONS.length)*100) : 0;
    barEl.style.width = `${pct}%`;
  }

  function renderQuestion(){
    if (qIndex >= idxOrder.length){
      endByQuestions();
      return;
    }

    const Q = QUESTIONS[idxOrder[qIndex]];
    qTextEl.textContent = `Q${answered + 1}. ${Q.q}`;
    optsEl.innerHTML = "";

    const letters = ["A","B","C","D"];
    Q.opts.forEach((txt, i) => {
      const btn = document.createElement("button");
      btn.className = "optBtn";
      btn.innerHTML = `<span class="lab">${letters[i]}</span><span>${escapeHtml(txt)}</span>`;
      btn.addEventListener("click", () => choose(i));
      optsEl.appendChild(btn);
    });
  }

  function choose(i){
    if (locked || gameOver) return;
    locked = true;

    const Q = QUESTIONS[idxOrder[qIndex]];
    const isCorrect = (i === Q.a);

    answered += 1;

    if (isCorrect){
      correct += 1;
      popOK("Correct!");
      const roll = rollDiceAnimated(() => {
        movePlayer(1, roll);
        showFeedback(true, Q.fb, () => {
          checkEnd();
          if (!gameOver) advanceQuestion();
        });
      });
    } else {
      popBad("Wrong!");
      app.classList.remove("shake");
      void app.offsetWidth;
      app.classList.add("shake");

      movePlayer(2, COMPUTER_STEP_ON_WRONG);

      const correctLetter = ["A","B","C","D"][Q.a];
      const correctText = Q.opts[Q.a];

      showFeedback(false,
        `Correct answer: <b>${correctLetter}</b> ‚Äî ${escapeHtml(correctText)}<br/><br/>${escapeHtml(Q.fb)}`,
        () => {
          checkEnd();
          if (!gameOver) advanceQuestion();
        }
      );
      diceEl.textContent = "‚Äî";
    }

    updateStats();
    renderTokens();
  }

  function rollDiceAnimated(onDone){
    const final = 1 + Math.floor(Math.random()*6);
    let ticks = 0;
    const timer = setInterval(() => {
      ticks++;
      diceEl.textContent = String(1 + Math.floor(Math.random()*6));
      if (ticks >= 10){
        clearInterval(timer);
        diceEl.textContent = String(final);
        if (typeof onDone === "function") onDone();
      }
    }, 60);
    return final;
  }

  function movePlayer(which, steps){
    if (which === 1){
      p1 = Math.min(FINISH_INDEX, p1 + steps);
      setStatus("Nice! You moved ahead.", `You advanced by ${steps}. Keep going.`);
    } else {
      p2 = Math.min(FINISH_INDEX, p2 + steps);
      setStatus("Careful. The system is catching up.", `Computer advanced by ${steps} because of a wrong answer.`);
    }
    renderTokens();
    updateStats();
  }

  function advanceQuestion(){
    qIndex += 1;
    locked = false;
    renderQuestion();
  }

  function checkEnd(){
    if (p1 >= FINISH_INDEX){
      gameOver = true;
      showModal(
        "You reached Home üéâ",
        `
          <div class="note">Great job. You reached Home first.</div>
          <div class="kbd">
            <div><b>Your score:</b> ${correct} / ${QUESTIONS.length}</div>
            <div><b>Model B note:</b> Computer never answers questions. It moves only on wrong answers.</div>
          </div>
        `
      );
      locked = true;
      return;
    }

    if (p2 >= FINISH_INDEX){
      gameOver = true;
      showModal(
        "System reached Home",
        `
          <div class="note">The system token reached Home first. This is <b>not a failure</b>. Your learning score is below.</div>
          <div class="kbd">
            <div><b>Your score:</b> ${correct} / ${QUESTIONS.length}</div>
            <div>Restart and focus on accuracy to stay ahead.</div>
          </div>
        `
      );
      locked = true;
      return;
    }
  }

  function endByQuestions(){
    gameOver = true;
    const acc = QUESTIONS.length ? Math.round((correct/QUESTIONS.length)*100) : 0;
    const pass = acc >= 60;

    showModal(
      "Quiz Finished",
      `
        <div class="note">You completed all questions. The board race is motivational; your learning score is primary.</div>
        <div class="kbd">
          <div><b>Correct:</b> ${correct} / ${QUESTIONS.length} (${acc}%)</div>
          <div><b>Status:</b> ${pass ? `<span style="color:rgba(34,197,94,.95);font-weight:900;">Good mastery</span>` :
                                   `<span style="color:rgba(251,191,36,.95);font-weight:900;">Needs revision</span>`}
          </div>
          <div>You can restart to practice again.</div>
        </div>
      `
    );
    locked = true;
  }

  function setStatus(t, s){
    statusTextEl.textContent = t;
    statusSubEl.textContent = s;
  }

  // ============================
  // MODALS
  // ============================
  function showHow(){
    showModal(
      "How to Play",
      `
        <div class="note">
          This is <b>Model B</b>: computer moves only when you answer incorrectly. It does not answer questions.
        </div>
        <div class="kbd">
          <div><b>Step 1:</b> Read the MCQ and choose an option.</div>
          <div><b>If correct:</b> Dice rolls automatically and your token moves forward.</div>
          <div><b>If wrong:</b> Your token stays, and the computer token moves <b>+${COMPUTER_STEP_ON_WRONG}</b>.</div>
          <div><b>Goal:</b> Reach <b>HOME</b> before the system token by keeping accuracy high.</div>
        </div>
        <div class="note" style="margin-top:10px">
          Tip: Use <b>Skip (No Move)</b> if you want to move to next question without changing positions.
        </div>
      `
    );
  }

  function showFeedback(isCorrect, html, onNext){
    const title = isCorrect ? "Correct ‚úÖ" : "Wrong ‚ùå";
    const body = `
      <div class="note">${html}</div>
      <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px;">
        <button class="primary" id="nextBtn">${gameOver ? "Close" : "Continue"}</button>
      </div>
    `;
    showModal(title, body);

    setTimeout(() => {
      const nextBtn = document.getElementById("nextBtn");
      if (nextBtn){
        nextBtn.addEventListener("click", () => {
          hideModal();
          if (typeof onNext === "function") onNext();
          locked = false;
        });
      }
    }, 0);
  }

  function showModal(title, html){
    modalTitle.textContent = title;
    modalBody.innerHTML = html;
    overlay.style.display = "flex";
  }
  function hideModal(){ overlay.style.display = "none"; }

  // ============================
  // POPUPS
  // ============================
  function popOK(txt){ showPop(txt, "ok"); }
  function popBad(txt){ showPop(txt, "bad"); }
  function popNeutral(txt){
    bigPop.className = "bigPop";
    bigPop.textContent = txt;
    bigPop.style.display = "block";
    setTimeout(() => bigPop.style.display="none", 850);
  }
  function showPop(txt, cls){
    bigPop.className = `bigPop ${cls}`;
    bigPop.textContent = txt;
    bigPop.style.display = "block";
    setTimeout(() => bigPop.style.display="none", 650);
  }

  // ============================
  // UTIL
  // ============================
  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
})();
</script>
</body>
</html>
